// Embeds the (public) Supabase Functions base URL into a generated TS module
// so that packaged production builds still know where to call even when
// process.env vars are not present at runtime.
// This is safe because the functions URL is not a secret.

const fs = require('fs');
const path = require('path');

const url = process.env.SUPABASE_FUNCTIONS_URL || '';
if (!url) {
  console.warn('[embed-supabase-url] SUPABASE_FUNCTIONS_URL missing in env; generated file will contain empty string.');
}
const outPath = path.join(__dirname, '..', 'src', 'main', 'generatedConfig.ts');
const contents = `// AUTO-GENERATED by scripts/embed-supabase-url.js\nexport const embedded = { supabaseFunctionsUrl: '${url.replace(/'/g, "\\'")}' };\n`;
fs.writeFileSync(outPath, contents, 'utf8');
console.log('[embed-supabase-url] wrote', outPath);
